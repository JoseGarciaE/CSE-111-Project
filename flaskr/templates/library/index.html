{% extends 'base.html' %}

{% block content %}
<!-- LIBRARIAN -->
{% if user == 'librarian' %}
<h3>
    Welcome librarian {{ g.user['u_name'] }}!
</h3>

<h3>
    <form method="post">
        Click here to view all library users
        <input name="button" type="submit" value="search users">
    </form>
</h3>

{% if libraryUsers %}
<h3>Registered Users at {{university["un_name"]}} </h3>

<form method="post">
    <select name="filter" id="filter">
        <option value=""></option>
        <option value="name">Name</option>
        <option value="email">Email</option>
    </select>
    <input name="input" id="input">
    <input name="button" type="submit" value="filter users">
    <input name="button" type="submit" value="refresh users">
</form>

<table border="1px black">
    <tr>
        <th>Name</th>
        <th>Email</th>
    </tr>
    {% for libraryUser in libraryUsers %}
    {% if not loop.last %}
    <tr>
        <td>{{ libraryUser['u_name']}}</td>
        <td>{{ libraryUser['u_email']}}</td>
    </tr>
    {% endif %}
    {% endfor %}

</table>

{% endif %}

{% endif %}

<!-- STUDENT -->
{% if user == 'student' %}
<h3>
    Welcome student {{ g.user['u_name'] }}!
</h3>
{% endif %}


<h3>Books availible at {{university["un_name"]}}</h3>

<form method="post">
    <select name="filter" id="filter">
        <option value=""></option>
        <option value="title">Title</option>
        <option value="author">Author</option>
        <option value="year">Year</option>
        <option value="isbn">ISBN</option>
    </select>
    <input name="input" id="input">

    <input name="button" type="submit" value="filter books">
    <input name="button" type="submit" value="refresh books">
</form>

{% if books %}

<table border="1px black">
    <tr>
        <th>Book</th>
        <th>Title</th>
        <th>Author</th>
        <th>Year</th>
        <th>ISBN</th>
    </tr>
    {% for book in books %}
    
    <tr class="clickable-row">
        <td>
            <img id="bookImage" src="{{ book['b_image_url']}}" onerror="this.onerror=null; this.src='Default.jpg'"
                alt="" width="100" height="150">
        </td>

        <td>{{ book['b_title']}}</td>
        <td>{{ book['a_authorname']}}</td>
        <td>{{ book['b_publishedyear']}}</td>
        <td id="book-isbn">{{ book['b_isbn']}}</td>
    </tr>
   
    {% endfor %}

</table>
{% endif %}

<script>
    $(function () {
        $('.clickable-row').click(function () {
            var isbn = $(this).find("td").last().text();
            var title = $(this).find("td").eq(1).text();
            var author = $(this).find("td").eq(2).text();
            var year = $(this).find("td").eq(3).text();

            $.getJSON('/book/process',
            {
                isbn: isbn,
                title: title,
                author: author,
                year: year
            },
            function(data) {
                // do nothing
            });

            window.location.href = '/book/description/'
        });
    });
</script>

{% endblock %}